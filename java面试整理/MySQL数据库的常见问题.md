## ycMySQL数据库的常见问题

#### Q1：说说对于MySQL常见的两种存储引擎：MyISAM与InnoDB的理解？

1. **count运算上的区别**

   MyISAM有缓存有表meta-data（行数等），因此做count（*）时，对于一个结构很好的查询是不需要消耗多少资源的。InnoDB则没有这种缓存。

2. **是否支持事务和奔溃后的安全修复**

   MyISAM强调的是性能，每次查询具有原子性，其执行速度比InnoDB更快，但是不提供事务支持。

   InnoDB提供事务支持、外部键等高级数据库功能。具有事务（commit）、回滚（rollback）和崩溃修复（crash recovery capabilities）的事务安全型表。

3. **是否支持外键**

   MyISAM不支持，InnoDB支持。



MyISAM更适合读密集的表。InnoDB更适合写密集的表。在数据库做主从分离的情况下 ，经常选择MyISAM作为主库的存储引擎。一般来说，如果需要事务支持，并且有较高的并发读取频率，InnoDB是个不错的选择（因为，MyISAM表锁的粒度太大，所以当表写并发量较高时，要等待的查询就会很多）。如果数据量很大，而且不需要支持事务，MyISAM是最好的选择（MyISAM支持压缩特性可以减少磁盘的占用）。



#### Q2：什么是存储过程，有哪些优缺点？

1. 概念

   存储过程，是一组为了完成特定功能的SQL语句集，经编译后存储在数据库中，用户调用存储过程并传递参数来执行它。

2. 优点

   - 重复使用

     一旦定义 ，可以反复调用，不需要重新编写sql语句

   - 安全

     通过参数传入数据，避免sql注入攻击，同时可以给存储过程配置权限，只让特定用户使用。

   - 减少网络流量

     调用过程时，只需要调用存储过程名和参数。

   - 升级的时候，甚至可以替换下sql脚本就可以，快速迭代实现业务需求。

3. 缺点

   - 调试不是很方便
   - 可移植性差
   - 很多存储过程不支持面向对象的设计，很难对业务进行逻辑封装
   - 代码可读性差，相当难维护
   - 对云环境不友好，分库分表方案对sql限制多，存储过程可以忽略。



#### Q3：索引是什么？有什么作用和优缺点？

【数据库索引总结---思维导图】

索引是对数据库表中一个或多个列值进行排序的结构，是帮助MySQL高效获取数据的数据结构。索引会提高查询速度（如果查询使用了索引），但是一定会减慢写入速度，因为每次写入都需要更新索引，所以索引只应该加在经常需要搜索的列上，不要加在写多读少的列上。

- 普通索引

- 唯一索引

  是在表上一个或多个字段组合建立的索引，这个（或几个）字段的值组合起来在表中是唯一的。一张表可以建多个唯一索引，但一般只建一个。

- 主键索引

  一种特殊的唯一索引，唯一索引允许列出现null值，而主键不允许null。一张表最多建立一个主键索引，也可以不建。

- 全文索引

- 聚集索引、非聚集索引

  聚集索引的叶子节点，就是数据节点。非聚集索引的节点仍然是索引结点，只不过有指向对应数据块的指针。



优点：

- 创建唯一索引，可以保证表中每一行数据的唯一性
- 加快数据的检索速度
- 减少磁盘io

缺点：

- 创建和维护索引需要耗费时间，时间随着数据量的增加而增加
- 需要占用额外的物理空间
- 对数据进行修改时，需要更新索引，降低了数据维护的速度。。。





#### Q4：什么是事务？

事务是并发控制的基本单元。它是一个操作序列，这些操作要么都执行，要么都不执行，是一个不可分割的工作单位。它是数据库维护数据一致性的单位，在每个事务结束时，都能保持数据的一致性。

**ACID：**

- 原子性

  事务是最小的执行单位，不可分割。要么全部成功，要么全部失败。

- 一致性

  执行事务前后，数据保持一致，多个事务对数据读取的结果是一致的。

- 隔离性

  并发访问时，一个用户的事务不被其他事务干扰。

- 持久性

  一个事务被提交后，对数据库中数据的改变是持久的，即使数据库发生故障也不应对其有任何影响。



**并发事务带来的问题**

- 脏读
- 丢失修改
- 不可重复读
- 幻读



**事务隔离级别**

- 读取未提交
- 读取已提交
- 可重复读
- 可串行化



InnoDB存储引擎默认支持的隔离级别是可重复度。（已经达到SQL标准的可串行化）

因为事务隔离级别越低，事务请求的锁就越少，大部分数据库的隔离级别是读取已提交，但是InnoDB存储引擎默认使用的并不会有任何性能损失。

InnoDB在分布式下一般会用到可串行化隔离级别。



#### Q5：数据库的乐观锁、悲观锁是什么？

数据库管理系统中的并发控制任务是确保在多个事务同时存取数据库中同一数据时不破坏事务的隔离性，统一性。

**乐观锁、悲观锁时数据库并发控制主要采用的技术手段。**

**乐观锁**

- 假定不会发生并发冲突，只在提交操作时，检查是否违反数据完整性。
- 版本号机制、CAS
- 优点：避免了长事务中的数据库加锁开销，提升并发量下系统整体性能表现。

**悲观锁**

- 假定会发生数据冲突，屏蔽一切可能违反数据完整性的操作。
- 优点：避免冲突发生
- 缺点：降低并发 效率
- 读锁（共享锁）、写锁（排他锁）



#### Q6：使用索引一定能提高查询的性能吗？为什么？

通常，通过索引查询数据比全表扫描快，但是依然有代价。

索引需要空间来存储，需要定期维护。每当有记录在表中增减或索引列被修改时，索引本身也会被修改。这意味着，每条记录的insert、update、delete将为此多付出磁盘IO操作，反而使查询变慢。

索引范围查询使用与两种情况：

- 基于一个范围的索引，一般查询返回结果集小于表中记录数的30%
- 基于非唯一性索引的检索



#### Q7：简单说一说**drop、delete**与**truncate**的区别？

都表示删除，但有一点区别。

- delete和truncate只删除表的内容，而不删除表的结构。
- 速度，一般来说drop>truncate>delete
- delete语句，是dml，这个操作会放到rollback segement中，事务提交后才生效，如果有响应的trigger，执行的时候会被触发。
- drop和truncate是ddl，操作立即生效，不会到rollback segement中，不能回滚，执行不触发trigger。



#### Q8：超键、候选键、主键、外键分别是什么？

超键：在关系中能唯一标识元祖的属性集称为关系模式的超键。

候选键：不含有多于属性的超键称为候选键。

主键：用户选座元祖标识的一个候选键称为超键。

外键：如果关系模式R1中的某属性不是R1的主键，而是关系模式R2的主键，则称该属性是关系模式R1中的外键。用来标识两个表的关系。



#### Q9：什么是视图？以及视图的使用场景有哪些？

视图是一种虚拟的表，具有和物理表相同的功能。可以对视图进行增删改查操作。

视图中的字段是来自一个或多个数据库中的真实的表中的字段。

数据库的设计和结构不会受到视图中的函数、where 或 join 语句的影响。

视图总是显示最近的数据。每当用户查询视图时，数据库引擎通过使用 SQL 语句来重建数据。



**优点：**

- 简化操作，把经常使用的数据定义为视图，可以将复杂的sql语句进行封装。
- 安全性，用户只能查询能看到的数据。
- 逻辑上独立性，屏蔽真实表结构带来的影响。



**缺点：**

- 性能差

  数据库必须把对视图的查询转化为对基表的查询，如果一个视图由多个基表构成，那么即使是一个简单的视图查询，也会变成一个复杂的结构体，需要花费一定的时间。

- 修改限制





#### Q10：说一说三个范式

第一范式1NF，数据库表中的字段都是单一属性，不可再分。**(确保每列保持原子性)**

第二范式，2NF在1NF的基础之上，消除了非主属性对于码的部分函数依赖。**(确保表中的每列都和主键相关)**

第三范式（3NF），3NF在2NF的基础之上，消除了非主属性对于码的传递函数依赖。**(确保每列都和主键列直接相关,而不是间接相关)**









